# ุฏููู ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช - Testing Notifications Guide

## ููููุฉ ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ุจุฏูู ูุชุญ ุงูุชุทุจูู

### ุงูุทุฑููุฉ 1: ุงุฎุชุจุงุฑ ูู Firebase Console (ุงูุฃุณูู)

#### ุงูุฎุทูุงุช:

1. **ุงูุชุญ Firebase Console:**
   - ุงุฐูุจ ุฅูู: https://console.firebase.google.com
   - ุงุฎุชุฑ ูุดุฑูุนู

2. **ุงุฐูุจ ุฅูู Cloud Messaging:**
   - ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **Engage** โ **Cloud Messaging**
   - ุฃู ูุจุงุดุฑุฉ: https://console.firebase.google.com/project/YOUR_PROJECT_ID/notification

3. **ุฅูุดุงุก ุฅุดุนุงุฑ ุฌุฏูุฏ:**
   - ุงุถุบุท ุนูู **"Send your first message"** ุฃู **"New notification"**
   - ุงููุฃ ุงูุจูุงูุงุช:
     - **Notification title:** ุนููุงู ุงูุฅุดุนุงุฑ (ูุซูุงู: "ูุณุงุฑ ุฌุฏูุฏ ูุชุงุญ")
     - **Notification text:** ูุต ุงูุฅุดุนุงุฑ (ูุซูุงู: "ุชู ุฅูุดุงุก ูุณุงุฑ ุฌุฏูุฏ: ูุณุงุฑ ุงูุฌููู")

4. **ุฅุถุงูุฉ Data (ููู ุฌุฏุงู):**
   - ุงุถุบุท ุนูู **"Additional options"** ุฃู **"Custom data"**
   - ุฃุถู ุงูุจูุงูุงุช ุงูุชุงููุฉ:

   **ูุฅุดุนุงุฑ ูุณุงุฑ/ุชุฎููู ุฌุฏูุฏ:**
   ```
   Key: type
   Value: new_route_camping
   
   Key: site_id
   Value: 123
   
   Key: site_type
   Value: route
   
   Key: site_name
   Value: ูุณุงุฑ ุงูุฌููู
   ```

   **ูุฅุดุนุงุฑ ุงูููุงููุฉ ุนูู ุฑุญูุฉ:**
   ```
   Key: type
   Value: trip_accepted
   
   Key: trip_id
   Value: 456
   
   Key: trip_name
   Value: ุฑุญูุฉ ุฅูู ุงููุฏุณ
   ```

5. **ุงุฎุชูุงุฑ ุงููุฏู:**
   - ุงุฎุชุฑ **"Send test message"**
   - ุฃุฏุฎู **FCM Token** ุงูุฎุงุต ุจู (ููููู ุงูุญุตูู ุนููู ูู logs ุงูุชุทุจูู)
   - ุฃู ุงุฎุชุฑ **"Send to topic"** ุฅุฐุง ููุช ุชุณุชุฎุฏู Topics

6. **ุฅุฑุณุงู ุงูุฅุดุนุงุฑ:**
   - ุงุถุบุท **"Test"** ุฃู **"Send"**
   - ุงูุฅุดุนุงุฑ ุณูุตู ุญุชู ูู ูุงู ุงูุชุทุจูู ูุบูู!

---

### ุงูุทุฑููุฉ 2: ุงูุญุตูู ุนูู FCM Token ููุงุฎุชุจุงุฑ

#### ูู ุงูุชุทุจูู (ุนูุฏ ูุชุญู ูุฑุฉ ูุงุญุฏุฉ):

1. ุงูุชุญ ุงูุชุทุจูู ูุฑุฉ ูุงุญุฏุฉ
2. ุงุจุญุซ ูู Console/Logs ุนู:
   ```
   โ FCM Token: dK3jH9fL2mN8pQ5rT7vW0xY3zA6bC9eF...
   ```
3. ุงูุณุฎ ุงูู Token

#### ุฃู ุฃุถู ุฒุฑ ููุงุฎุชุจุงุฑ ูู ุงูุชุทุจูู:

ููููู ุฅุถุงูุฉ ุฒุฑ ูู ุตูุญุฉ Settings ุฃู Profile ูุนุฑุถ ุงูู Token:

```dart
// ูู ุตูุญุฉ Settings ุฃู Profile
ElevatedButton(
  onPressed: () async {
    final token = await FCMService.instance.fcmToken;
    if (token != null) {
      // ุนุฑุถ Token ูู Dialog ุฃู ูุณุฎู
      showDialog(
        context: context,
        builder: (context) => AlertDialog(
          title: Text('FCM Token'),
          content: SelectableText(token),
          actions: [
            TextButton(
              onPressed: () {
                Clipboard.setData(ClipboardData(text: token));
                ScaffoldMessenger.of(context).showSnackBar(
                  SnackBar(content: Text('ุชู ูุณุฎ Token')),
                );
              },
              child: Text('ูุณุฎ'),
            ),
          ],
        ),
      );
    }
  },
  child: Text('ุนุฑุถ FCM Token'),
)
```

---

### ุงูุทุฑููุฉ 3: ุงุฎุชุจุงุฑ ูู Backend API

ุฅุฐุง ูุงู ูุฏูู Backend API ุฌุงูุฒุ ููููู ุฅุฑุณุงู ุฅุดุนุงุฑ ูุจุงุดุฑุฉ:

```bash
curl -X POST https://fcm.googleapis.com/v1/projects/YOUR_PROJECT_ID/messages:send \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": {
      "token": "USER_FCM_TOKEN",
      "notification": {
        "title": "ูุณุงุฑ ุฌุฏูุฏ ูุชุงุญ",
        "body": "ุชู ุฅูุดุงุก ูุณุงุฑ ุฌุฏูุฏ: ูุณุงุฑ ุงูุฌููู"
      },
      "data": {
        "type": "new_route_camping",
        "site_id": "123",
        "site_type": "route",
        "site_name": "ูุณุงุฑ ุงูุฌููู"
      }
    }
  }'
```

---

## ุญุงูุงุช ุงูุงุฎุชุจุงุฑ

### 1. ุงูุชุทุจูู ููุชูุญ (Foreground)
- ุงูุฅุดุนุงุฑ ุณูุธูุฑ ูู `FirebaseMessaging.onMessage`
- ุณูุชู ุฅุถุงูุชู ุชููุงุฆูุงู ุฅูู NotificationsProvider
- ููููู ุฑุคูุชู ูู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช

### 2. ุงูุชุทุจูู ูู ุงูุฎูููุฉ (Background)
- ุงูุฅุดุนุงุฑ ุณูุธูุฑ ูู ุงููุธุงู
- ุนูุฏ ุงูุถุบุท ุนูููุ ุณูุชู ูุชุญ ุงูุชุทุจูู
- ุณูุชู ุงูุชููู ููุตูุญุฉ ุงูููุงุณุจุฉ ุญุณุจ `type`

### 3. ุงูุชุทุจูู ูุบูู (Terminated)
- ุงูุฅุดุนุงุฑ ุณูุธูุฑ ูู ุงููุธุงู
- ุนูุฏ ุงูุถุบุท ุนูููุ ุณูุชู ูุชุญ ุงูุชุทุจูู
- ุณูุชู ุงูุชููู ููุตูุญุฉ ุงูููุงุณุจุฉ ุจุนุฏ ุซุงููุฉ ูุงุญุฏุฉ (ูุถูุงู ุชููุฆุฉ ุงูุชุทุจูู)

---

## ุฃูุซูุฉ Payloads ููุงุฎุชุจุงุฑ

### ูุซุงู 1: ุฅุดุนุงุฑ ูุณุงุฑ ุฌุฏูุฏ
```json
{
  "notification": {
    "title": "ูุณุงุฑ ุฌุฏูุฏ ูุชุงุญ",
    "body": "ุชู ุฅูุดุงุก ูุณุงุฑ ุฌุฏูุฏ: ูุณุงุฑ ุงูุฌููู"
  },
  "data": {
    "type": "new_route_camping",
    "site_id": "123",
    "site_type": "route",
    "site_name": "ูุณุงุฑ ุงูุฌููู"
  }
}
```

### ูุซุงู 2: ุฅุดุนุงุฑ ุชุฎููู ุฌุฏูุฏ
```json
{
  "notification": {
    "title": "ูููุน ุชุฎููู ุฌุฏูุฏ",
    "body": "ุชู ุฅุถุงูุฉ ูููุน ุชุฎููู ุฌุฏูุฏ: ูุงุฏู ุงูููุท"
  },
  "data": {
    "type": "new_route_camping",
    "site_id": "456",
    "site_type": "camping",
    "site_name": "ูุงุฏู ุงูููุท"
  }
}
```

### ูุซุงู 3: ุฅุดุนุงุฑ ุงูููุงููุฉ ุนูู ุฑุญูุฉ
```json
{
  "notification": {
    "title": "ุชู ูุจูู ุทูุจู",
    "body": "ุชู ูุจูู ุทูุจู ููุงูุถูุงู ุฅูู ุฑุญูุฉ: ุฑุญูุฉ ุฅูู ุงููุฏุณ"
  },
  "data": {
    "type": "trip_accepted",
    "trip_id": "789",
    "trip_name": "ุฑุญูุฉ ุฅูู ุงููุฏุณ"
  }
}
```

---

## ูุตุงุฆุญ ูููุฉ

1. **ุชุฃูุฏ ูู ุฅุฑุณุงู Token ููู Backend:**
   - Token ูุชู ุฅุฑุณุงูู ุชููุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
   - ููููู ุงูุชุญูู ูู logs: `โ FCM Token sent successfully`

2. **ููุงุฎุชุจุงุฑ ุจุฏูู Backend:**
   - ุงุณุชุฎุฏู Firebase Console ูุจุงุดุฑุฉ
   - ุฃุฏุฎู FCM Token ูุฏููุงู

3. **ููุงุฎุชุจุงุฑ ูุน Backend:**
   - ุชุฃูุฏ ูู ุฃู Backend ูุฑุณู ุงูุฅุดุนุงุฑุงุช ุจุดูู ุตุญูุญ
   - ุชุญูู ูู ุฃู `data` ุชุญุชูู ุนูู `type` ู ุงูุจูุงูุงุช ุงููุทููุจุฉ

4. **ูุดุงูู ุดุงุฆุนุฉ:**
   - ุฅุฐุง ูู ูุตู ุงูุฅุดุนุงุฑ: ุชุญูู ูู FCM Token
   - ุฅุฐุง ูุตู ุงูุฅุดุนุงุฑ ููู ูุง ููุฌุฏ ุชููู: ุชุญูู ูู `data.type`
   - ุฅุฐุง ูู ูุธูุฑ ูู ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช: ุชุญูู ูู NotificationsProvider

---

## ุงูุชุญูู ูู ุนูู ุงูุฅุดุนุงุฑุงุช

### ูู ุงูุชุทุจูู:
1. ุงูุชุญ ุตูุญุฉ ุงูุฅุดุนุงุฑุงุช: `/notifications`
2. ูุฌุจ ุฃู ุชุฑู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุณุชููุฉ
3. ุนูุฏ ุงูุถุบุท ุนูู ุฅุดุนุงุฑุ ูุฌุจ ุงูุชููู ููุตูุญุฉ ุงูููุงุณุจุฉ

### ูู Logs:
ุงุจุญุซ ุนู:
```
๐ฑ Foreground message received: ...
๐ฑ Background message received: ...
โ FCM Token: ...
```

---

**ููุงุญุธุฉ:** ููุชุฃูุฏ ูู ุฃู ุงูุฅุดุนุงุฑุงุช ุชุนูู ุจุฏูู ูุชุญ ุงูุชุทุจููุ ุฃุฑุณู ุฅุดุนุงุฑ ูู Firebase Console ุจูููุง ุงูุชุทุจูู ูุบูู ุชูุงูุงู. ูุฌุจ ุฃู ูุธูุฑ ุงูุฅุดุนุงุฑ ูู ุงููุธุงูุ ูุนูุฏ ุงูุถุบุท ุนููู ูุฌุจ ุฃู ููุชุญ ุงูุชุทุจูู ูููุชูู ููุตูุญุฉ ุงูููุงุณุจุฉ.

