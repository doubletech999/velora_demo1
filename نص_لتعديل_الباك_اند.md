# ๐ ูุต ููุชุนุฏูู ุนูู Laravel Backend

## ุงููุทููุจ:
ุชุนุฏูู Laravel API ูุฏุนู ุชุทุจูู Flutter ุงูุฐู ููุตู ุจูู ุงูุฃูุงูู ุงูุณูุงุญูุฉ ูุงููุณุงุฑุงุช ูุงูุชุฎูููุงุช.

---

## ุงูุชุนุฏููุงุช ุงููุทููุจุฉ:

### 1. ุฅุถุงูุฉ ุนููุฏ `type` ูู ุฌุฏูู `sites`:
```php
// ูู Migration
Schema::table('sites', function (Blueprint $table) {
    $table->enum('type', ['site', 'route', 'camping'])->default('site')->after('id');
});
```

**ุงูููู:**
- `'site'` โ ุงูุฃูุงูู ุงูุณูุงุญูุฉ
- `'route'` โ ุงููุณุงุฑุงุช
- `'camping'` โ ุงูุชุฎูููุงุช

---

### 2. ุชุนุฏูู Controller `/api/sites`:

**ุงููุทููุจ:**
- ุฏุนู ูุนุงูู `type` ููุชุตููู
- ุฏุนู pagination
- ุฏุนู ุงูุจุญุซ ุนุจุฑ `search`

**ุงูููุฏ:**
```php
public function index(Request $request)
{
    $query = Site::with(['guide.user']); // Eager loading
    
    // Filter by type
    if ($request->has('type') && $request->type) {
        $query->where('type', $request->type);
    }
    
    // Search
    if ($request->has('search') && $request->search) {
        $query->where(function ($q) use ($request) {
            $q->where('name', 'like', '%' . $request->search . '%')
              ->orWhere('name_ar', 'like', '%' . $request->search . '%')
              ->orWhere('description', 'like', '%' . $request->search . '%')
              ->orWhere('description_ar', 'like', '%' . $request->search . '%');
        });
    }
    
    // Pagination
    $sites = $query->paginate(10);
    
    return response()->json($sites);
}
```

---

### 3. ุชุนุฏูู API Resource:

**ุงููุทููุจ:**
ูุฌุจ ุฃู ูุญุชูู Response ุนูู ุฌููุน ุงูุญููู ุงูุชุงููุฉ:

```php
public function toArray($request)
{
    return [
        'id' => $this->id,
        'name' => $this->name,
        'name_ar' => $this->name_ar,
        'description' => $this->description,
        'description_ar' => $this->description_ar,
        'type' => $this->type, // 'site', 'route', 'camping'
        'location' => $this->location,
        'location_ar' => $this->location_ar,
        'latitude' => (string) $this->latitude,
        'longitude' => (string) $this->longitude,
        'images' => $this->images->map(function ($image) {
            return asset('storage/' . $image->path);
        })->toArray(),
        'length' => (float) $this->length,
        'distance' => (float) $this->length, // ููุชูุงูู
        'distance_km' => (float) $this->length, // ููุชูุงูู
        'estimated_duration' => (int) $this->estimated_duration, // ุจุงูุณุงุนุงุช
        'duration' => (int) $this->estimated_duration, // ููุชูุงูู
        'duration_hours' => (int) $this->estimated_duration, // ููุชูุงูู
        'difficulty' => $this->difficulty, // 'easy', 'medium', 'hard'
        'activities' => $this->activities ?? [], // JSON array
        'rating' => (float) $this->rating,
        'review_count' => $this->reviews()->count(),
        'reviews_count' => $this->reviews()->count(), // ููุชูุงูู
        'price' => (float) $this->price,
        'guide_id' => $this->guide_id,
        'guide_name' => $this->guide->user->name ?? null, // โญ ููู
        'guide_name_ar' => $this->guide->user->name_ar ?? null, // โญ ููู
        'guide' => [
            'id' => $this->guide->id,
            'name' => $this->guide->user->name ?? null,
            'name_ar' => $this->guide->user->name_ar ?? null,
            'route_price' => (float) $this->guide->route_price,
            'rating' => (float) $this->guide->rating,
            'review_count' => $this->guide->reviews()->count(),
            'user' => [
                'name' => $this->guide->user->name,
                'name_ar' => $this->guide->user->name_ar,
                'email' => $this->guide->user->email,
            ],
        ],
    ];
}
```

---

### 4. ุงูุญููู ุงููุทููุจุฉ ูู Database:

```php
// ูู Migration
$table->enum('type', ['site', 'route', 'camping'])->default('site');
$table->json('activities')->nullable(); // ['hiking', 'camping', ...]
$table->decimal('latitude', 10, 8)->nullable();
$table->decimal('longitude', 11, 8)->nullable();
$table->integer('estimated_duration')->default(2); // ุจุงูุณุงุนุงุช
$table->enum('difficulty', ['easy', 'medium', 'hard'])->default('easy');
$table->decimal('price', 8, 2)->default(0);
$table->decimal('rating', 3, 2)->default(0);
```

---

### 5. Response Format ุงููุทููุจ:

**Pagination Format:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "ุงุณู ุงููููุน",
      "name_ar": "ุงุณู ุงููููุน ุจุงูุนุฑุจูุฉ",
      "type": "site",
      "guide_name": "ุงุณู ุงููุฑุดุฏ",
      "guide_name_ar": "ุงุณู ุงููุฑุดุฏ ุจุงูุนุฑุจูุฉ",
      "guide": { ... },
      ...
    }
  ],
  "current_page": 1,
  "last_page": 5,
  "per_page": 10,
  "total": 50
}
```

---

### 6. Endpoints ุงููุทููุจุฉ:

```
GET /api/sites?type=site&page=1      โ ุงูุฃูุงูู ุงูุณูุงุญูุฉ
GET /api/sites?type=route&page=1     โ ุงููุณุงุฑุงุช
GET /api/sites?type=camping&page=1   โ ุงูุชุฎูููุงุช
GET /api/sites?page=1                โ ุฌููุน ุงูููุงูุน
GET /api/sites?search=ุฌุจู&page=1     โ ุงูุจุญุซ
```

---

### 7. CORS Configuration:

```php
// ูู config/cors.php
'paths' => ['api/*'],
'allowed_methods' => ['*'],
'allowed_origins' => ['http://localhost:*', 'http://10.0.2.2:*'],
'allowed_headers' => ['*'],
'supports_credentials' => true,
```

---

### 8. Authentication (Optional):

- ุงูู endpoint ูุฌุจ ุฃู ูุนูู ุจุฏูู authentication (ููุถูู)
- ุฅุฐุง ูุงู ููุงู Bearer Tokenุ ูููู ุงุณุชุฎุฏุงูู (ููู ุบูุฑ ูุทููุจ)

---

## โ Checklist:

- [ ] ุฅุถุงูุฉ ุนููุฏ `type` ูู migration
- [ ] ุชุนุฏูู Controller ูุฏุนู `type` filter
- [ ] ุชุนุฏูู Resource ูุฅุฑุฌุงุน ุฌููุน ุงูุญููู
- [ ] ุฅุถุงูุฉ `guide_name` ู `guide_name_ar` ูู response
- [ ] ุงูุชุฃูุฏ ูู pagination
- [ ] ุงูุชุฃูุฏ ูู CORS
- [ ] ุงุฎุชุจุงุฑ API endpoints

---

## ๐งช ุงุฎุชุจุงุฑ:

```bash
# ุงูุฃูุงูู ุงูุณูุงุญูุฉ
curl http://localhost:8000/api/sites?type=site

# ุงููุณุงุฑุงุช
curl http://localhost:8000/api/sites?type=route

# ุงูุชุฎูููุงุช
curl http://localhost:8000/api/sites?type=camping
```

---

## ๐ ููุงุญุธุงุช ูููุฉ:

1. **Backward Compatibility**: ูุฌุจ ุฃู ูุนูู API ุจุฏูู `type` (ูุฑุฌุน ุฌููุน ุงูููุงูุน)
2. **Performance**: ุงุณุชุฎุฏู eager loading ููู relationships
3. **Validation**: ุชุญูู ูู `type` values
4. **Error Handling**: ุฃุนุฏ error messages ูุงุถุญุฉ

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ:

ุจุนุฏ ุงูุชุนุฏููุ ูุฌุจ ุฃู ูุนูู Flutter App ูุน Laravel API:
- โ ุฌูุจ ุงูุฃูุงูู ุงูุณูุงุญูุฉ (`type=site`)
- โ ุฌูุจ ุงููุณุงุฑุงุช (`type=route`)
- โ ุฌูุจ ุงูุชุฎูููุงุช (`type=camping`)
- โ ุนุฑุถ ุฌููุน ุงูุจูุงูุงุช ุจุดูู ุตุญูุญ
- โ ุฏุนู pagination
- โ ุฏุนู ุงูุจุญุซ

